<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Countdown</title>
  <meta name="description" content="Countdown">
  <meta name="viewport" content="width=device-width, initial-scale=1.0,user-scalable=0" />
  <link href="https://erichsia7.github.io/countdown/pwaicon/512x512.png" sizes="512x512"
    rel="apple-touch-icon-precomposed" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="defualt" />
  <link type="image/x-icon" href="https://erichsia7.github.io/countdown/pwaicon/256x256_corner_radius.ico" rel="icon" />
  <link type="image/x-icon" href="https://erichsia7.github.io/countdown/pwaicon/256x256_corner_radius.ico"
    rel="bookmark" />
  <link type="image/x-icon" href="https://erichsia7.github.io/countdown/pwaicon/256x256_corner_radius.ico"
    rel="shortcut icon" />
  <meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff" kji="light">
  <meta name="theme-color" media="(prefers-color-scheme: dark)" content="#0d0d0d" kji="dark">
  <link rel="manifest" href="https://erichsia7.github.io/countdown/manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@200;400;500;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --d-ffffff: #ffffff;
      --d-e3e3e3: #e3e3e3;
      --d-333333: #333333;
      --d-fafafa: #fafafa;
      --d-f4f4f4: #f4f4f4;
      --e-skeleton-screen-light-color: #f2f2f2;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --d-ffffff: #0d0d0d;
        --d-e3e3e3: #1a1a1a;
        --d-333333: #ffffff;
        --d-fafafa: #141414;
        --d-f4f4f4: #1a1a1a;
        --e-skeleton-screen-light-color: #262626;
      }
    }

    * {
      -webkit-appearance: none;
      appearance: none;
      outline: none;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      font-family: 'Noto Sans', sans-serif;
    }

    body {
      background: var(--d-ffffff)
    }

    .title,
    .countdown_title,
    .add_countdown_title,
    .edit_countdown_title {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 55px;
      background: var(--d-ffffff);
      border-bottom: 1px solid var(--d-e3e3e3);
      box-sizing: border-box;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 20px;
      font-weight: 200;
      color: var(--d-333333);
      -webkit-user-select: none;
      user-select: none;
    }

    .countdown_title,
    .add_countdown_title,
    .edit_countdown_title {
      display: none;
    }

    .content_box,
    .countdown_content_box,
    .add_countdown_content_box,
    .edit_countdown_content_box,
    .search_countdown_content_box {
      position: fixed;
      top: 55px;
      left: 0px;
      width: 100%;
      height: calc(100% - 55px);
      background: var(--d-ffffff);
      overflow: scroll;
      -webkit-user-select: none;
      user-select: none;
    }

    .countdown_content_box,
    .add_countdown_content_box,
    .edit_countdown_content_box,
    .search_countdown_content_box {
      display: none;
    }

    .search_countdown_content_box {
      overflow: hidden;
    }

    .countdown_content_box_count_finish {
      font-size: 25px;
      font-weight: 700;
    }

    .addcountdown {
      position: fixed;
      bottom: 20px;
      right: 20px;
      border-radius: 99em;
      background: var(--d-e3e3e3);
      width: 55px;
      height: 55px;
      box-shadow: 0 0 15px 2px rgba(0, 0, 0, 0.08);
      -webkit-user-select: none;
      user-select: none;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .countdown_box {
      width: calc(100% - 20px);
      height: 100px;
      background: var(--d-ffffff);
      position: relative;
      -webkit-user-select: none;
      user-select: none;
      overflow: hidden;
      border-radius: 15px;
      margin: 10px;
      box-sizing: border-box;
      border: 1px solid var(--d-f4f4f4);
      box-shadow: 0px 0px 12px -8px rgba(0, 0, 0, 0.15);
    }

    .countdown_box:nth-last-child(1) {
      margin-bottom: 20px
    }

    .countdown_box_select {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 44px;
      height: 100px;
      display: none;
      justify-content: center;
      align-items: center;
      background: var(--d-ffffff);
      box-sizing: border-box;
      font-size: 23px;
      color: var(--d-333333);
      -webkit-user-select: none;
      user-select: none;
    }

    .countdown_box_select label {
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0);
    }

    .countdown_box_count {
      position: absolute;
      top: 5px;
      left: 5px;
      width: 95px;
      height: 90px;
      display: flex;
      justify-content: center;
      align-items: center;
      background: var(--d-ffffff);
      border-right: 1px solid var(--d-fafafa);
      box-sizing: border-box;
      font-size: 23px;
      font-weight: 700;
      color: var(--d-333333);
      -webkit-user-select: none;
      user-select: none;
      overflow: hidden;
    }

    .countdown_box_title {
      position: absolute;
      top: 5px;
      left: 105px;
      width: calc(100% - 110px);
      height: 35px;
      display: flex;
      align-items: center;
      background: var(--d-ffffff);
      box-sizing: border-box;
      padding: 3px;
      color: var(--d-333333);
      -webkit-user-select: none;
      user-select: none;
      word-break: keep-all;
      white-space: nowrap;
      overflow: hidden;
      font-weight: 500;
      font-size: 16px;
    }

    .countdown_box_description {
      position: absolute;
      top: 40px;
      left: 105px;
      width: calc(100% - 110px);
      height: calc(100% - 45px);
      background: var(--d-ffffff);
      box-sizing: border-box;
      padding: 3px;
      color: var(--d-333333);
      -webkit-user-select: none;
      user-select: none;
      word-break: break-all;
      overflow: hidden;
      white-space: pre-line;
      font-weight: 400;
      font-size: 16px;
    }

    .countdown_box.loading {
      background: var(--d-ffffff);
    }

    .countdown_box.loading .countdown_box_count::after,
    .countdown_box.loading .countdown_box_title::after,
    .countdown_box.loading .countdown_box_description::after {
      content: '';
      background: var(--d-fafafa);
      position: absolute;
      border-radius: 9px;
    }

    .countdown_box.loading .countdown_box_count::after {
      top: 5px;
      left: 5px;
      width: calc(100% - 10px);
      height: calc(100% - 10px);
    }

    .countdown_box.loading .countdown_box_title::after {
      top: 5px;
      left: 0px;
      width: calc(100% - 5px);
      height: calc(100% - 10px);
    }

    .countdown_box.loading .countdown_box_description::after {
      top: 0px;
      left: 0px;
      width: calc(100% - 5px);
      height: calc(100% - 5px);

    }

    .content_box[edit="1"] .countdown_box .countdown_box_count,
    .content_box[edit="1"] .countdown_box .countdown_box_title,
    .content_box[edit="1"] .countdown_box .countdown_box_description {
      transform: translateX(45px);
      opacity: 0.6;
    }

    .content_box[edit="1"] .countdown_box_select {
      display: flex;
    }

    .add_countdown_content_box input[c="1"],
    .add_countdown_content_box textarea,
    .edit_countdown_content_box input[c="1"],
    .edit_countdown_content_box textarea {
      width: calc(100% - 20px);
      height: 45px;
      border: 1px solid var(--d-e3e3e3);
      border-radius: 10px;
      background: transparent;
      -webkit-appearance: none;
      appearance: none;
      color: var(--d-333333);
      font-size: 15px;
      margin-top: 10px;
      box-sizing: border-box;
      padding: 5px;
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      background: transparent;
      caret-color: var(--d-333333);
    }

    .date_input_group {
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      width: calc(100% - 20px);
      height: 95px;
      margin-top: 10px;
      box-sizing: border-box;
    }

    .date_input_group_date,
    .date_input_group_time {
      position: absolute;
      width: 100%;
      height: 45px;
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      column-gap: 5px;
    }

    .date_input_group_date {
      top: 0px;
      left: 0px;
    }

    .date_input_group_time {
      top: 50px;
      left: 0px;
    }

    .date_input_group input[type="text"] {
      -webkit-appearance: none;
      appearance: none;
      display: inline-block;
      height: 45px;
      padding: 5px;
      margin: 0px;
      box-sizing: border-box;
      font-size: 15px;
      border-radius: 10px;
      border: 1px solid var(--d-e3e3e3);
      background: transparent;
      color: var(--d-333333);
      min-width: 0px;
      caret-color: var(--d-333333);
    }

    .add_countdown_content_box textarea,
    .edit_countdown_content_box textarea {
      height: 135px;
    }

    .add_countdown_btn,
    .edit_countdown_btn {
      height: 45px;
      width: calc(100% - 20px);
      background: var(--d-e3e3e3);
      color: var(--d-333333);
      display: flex;
      justify-content: center;
      align-items: center;
      border-radius: 10px;
      position: relative;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 10px;
      user-select: none;
      -webkit-user-select: none;
    }


    .promptcenter {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--d-333333);
      font-size: 15px;
      font-family: "Noto Sans TC", sans-serif;
      user-select: none;
      -webkit-user-select: none;
    }

    .promptcenter * {
      color: var(--d-333333);
      font-size: 15px;
      font-family: "Noto Sans TC", sans-serif
    }

    .prompt {
      width: clamp(180px, calc(100% - 40px), 450px);
      height: 60px;
      border-radius: 15px;
      position: fixed;
      left: 50%;
      bottom: 0px;
      opacity: 0;
      transform: translateX(-50%) translateY(0px) scale(0.75);
      background: var(--d-e3e3e3);
      box-shadow: 0 0 15px 2px rgba(0, 0, 0, 0.08);
      will-change: transform, opacity;
      -webkit-user-select: none;
      user-select: none;
    }

    .back_btn,
    .trash_back_btn,
    .options_btn,
    .delete_btn,
    .cancel_btn,
    .search_btn {
      width: 35px;
      height: 35px;
      position: absolute;
      overflow: hidden;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .back_btn,
    .trash_back_btn {
      top: 10px;
      left: 10px;
    }

    .trash_back_btn {
      display: none;
    }

    .options_btn {
      top: 10px;
      right: 10px;
    }

    .cancel_btn {
      top: 10px;
      right: 10px;
      display: none;
    }

    .delete_btn {
      top: 10px;
      right: 55px;
      display: none;
    }

    .search_btn {
      top: 10px;
      right: 55px
    }

    .search_btn[loading="1"],
    .options_btn[loading="1"] {
      opacity: 0.3;
    }

    input#search_countdown {
      color: var(--d-333333);
      caret-color: var(--d-333333);
      background: var(--d-ffffff);
      height: 45px;
      width: calc(100% - 55px);
      position: absolute;
      top: 50%;
      transform: translateY(-50%) translateX(0px);
      left: 55px;
      border: none;
      -webkit-appearance: none;
      appearance: none;
      border-radius: 0px;
      padding: 0px 10px 0px 0px;
      margin: 0px;
      font-size: 20px;
      font-weight: 400;
      box-sizing: border-box;
    }

    .search_btn[u="0"] .back_btn {
      display: none;
    }

    .search_btn[u="0"] input#search_countdown {
      display: block;
      opacity: 0;
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      padding: 0px;
      margin: 0px;
      box-sizing: border-box;
      caret-color: rgba(0, 0, 0, 0);
      transform: translateX(0px) translateY(0px);
    }

    .search_btn[u="1"] {
      top: 0px;
      right: 0px;
      height: 54px;
      width: 100%;
      background: var(--d-ffffff);
      box-sizing: border-box;
      display: block;
    }

    .search_btn[u="1"] input#search_countdown {
      display: block;
    }

    .search_btn[u="1"] .back_btn {
      display: flex;
    }

    .search_btn[loading="1"] input#search_countdown {
      display: none;
    }

    .addcountdown svg,
    .back_btn svg,
    .trash_back_btn svg,
    .options_btn svg,
    .delete_btn svg,
    .cancel_btn svg,
    .search_btn[u="0"] svg#svgsearchicon {
      width: 20px;
      height: 20px
    }

    .addcountdown[loading="1"] svg {
      opacity: 0.3;
    }

    .search_btn[u="1"] svg#svgsearchicon {
      display: none;
    }

    .countdown_content_box_count {
      width: calc(100% - 20px);
      height: 250px;
      position: absolute;
      top: 10px;
      left: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: row;
      color: var(--d-333333);
      user-select: none;
      -webkit-user-select: none;
    }

    .countdown_content_box_line {
      width: calc(100% - 20px);
      height: 1px;
      background: var(--d-e3e3e3);
      position: absolute;
      top: calc(10px + 250px + 5px);
      left: 10px;
      user-select: none;
      -webkit-user-select: none;
    }

    .countdown_content_box_details {
      width: calc(100% - 20px);
      height: auto;
      display: inline-block;
      position: absolute;
      top: calc(10px + 250px + 5px + 1px + 5px);
      left: 10px;
      color: var(--d-333333);
      user-select: none;
      -webkit-user-select: none;
      padding-bottom: 20px;
    }

    .countdown_content_box_details .h3,
    .countdown_content_box_details .p {
      display: inline-block;
      margin: 5px;
      padding: 0px;
      color: var(--d-333333);
      word-break: break-all;
      white-space: pre-line;
      user-select: none;
      -webkit-user-select: none;
      width: 100%;
      box-sizing: border-box;
    }

    .countdown_content_box_details .h3 {
      font-size: 18px;
      font-weight: 700;
    }

    .countdown_content_box_details .p {
      font-size: 16px;
      font-weight: 400;
    }

    .options_mask {
      position: fixed;
      top: 0px;
      left: 0px;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: none;
      user-select: none;
      -webkit-user-select: none;
    }

    .options {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: clamp(200px, 90%, 450px);
      height: auto;
      min-height: 45px;
      display: none;
      background: var(--d-ffffff);
      border-radius: 10px;
      overflow: scroll;
      -webkit-mask-image: -webkit-radial-gradient(white, black);
      mask-image: -webkit-radial-gradient(white, black);
      max-height: 450px;
      user-select: none;
      -webkit-user-select: none;
    }

    .options li {
      width: 100%;
      padding-left: 10px;
      height: 45px;
      border-top: 1px solid var(--d-e3e3e3);
      box-sizing: border-box;
      color: var(--d-333333);
      font-size: 16px;
      display: flex;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
    }

    .options li[b="0"] {
      border: none;
    }

    input[type="checkbox"] {
      -webkit-appearance: none;
      appearance: none;
      width: 20px;
      height: 20px;
      border-radius: 25%;
      margin: 0px;
      padding: 0px;
      outline: none;
      -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
      background: transparent;
      position: relative;
      border: 2px solid var(--d-333333);
      box-sizing: border-box;
      user-select: none;
      -webkit-user-select: none;
    }

    input[type="checkbox"]:checked {
      background: var(--d-333333);
    }

    input[type="checkbox"]::after {
      content: '';
      position: absolute;
      top: 3px;
      left: 3px;
      width: 10px;
      height: 10px;
      background: var(--d-333333);
      clip-path: path('M3.33333 8.66667L2.66667 8L0 5.33333L0.666667 4.66667L3.33333 7.33333L9.33333 1.33333L10 2L4 8L3.33333 8.66667Z')
    }

    input[type="checkbox"]:checked::after {
      background: var(--d-fafafa);
    }

    .count {
      width: 35px;
      height: 55px;
      background: var(--d-e3e3e3);
      position: relative;
      overflow: hidden;
      border-radius: 10px;
      margin: 2px;
      user-select: none;
      -webkit-user-select: none;
    }

    .count_track {
      position: absolute;
      top: 0px;
      left: 0px;
      width: 100%;
      height: calc(100% * 15);
      transform: translateY(calc(var(--count-number) * -55px));
      transition: 0.5s;
      user-select: none;
      -webkit-user-select: none;
    }

    .count_track span {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: calc(100% / 15);
      font-size: 25px;
      color: var(--d-333333);
      user-select: none;
      -webkit-user-select: none;
    }

    .search_result {
      position: absolute;
      width: 100%;
      height: 100%;
      overflow: scroll;
      user-select: none;
      -webkit-user-select: none;
    }

    .search_result li.search_result_countdown_box {
      list-style: none;
      background: var(--d-ffffff);
      color: var(--d-333333);
      width: 100%;
      height: 45px;
      border: none;
      border-bottom: 1px solid var(--d-f4f4f4);
      padding: 0px;
      margin: 0px;
      position: relative;
      display: block;
      user-select: none;
      -webkit-user-select: none;
    }

    .search_result li.search_result_countdown_box .search_result_countdown_count {
      position: absolute;
      top: 0px;
      left: 0px;
      height: 45px;
      width: 55px;
      font-size: 14px;
      color: var(--d-333333);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      white-space: nowrap;
      background: var(--d-ffffff);
      font-weight: 700;
      user-select: none;
      -webkit-user-select: none;
      box-sizing: border-box;
      padding: 2px;
    }

    .search_result li.search_result_countdown_box .search_result_countdown_count[f="1"] {
      font-size: 16px;
    }

    .search_result li.search_result_countdown_box[trash="true"] .search_result_countdown_count {
      color: var(--d-333333);
      font-style: italic;
      font-size: 14px;
    }

    .search_result li.search_result_countdown_box .search_result_countdown_title {
      position: absolute;
      top: 0px;
      left: 55px;
      height: 45px;
      width: calc(100% - 55px);
      font-size: 20px;
      color: var(--d-333333);
      display: flex;
      align-items: center;
      overflow: hidden;
      white-space: nowrap;
      background: var(--d-ffffff);
      box-sizing: border-box;
      padding-left: 0px;
      font-weight: 400;
      user-select: none;
      -webkit-user-select: none;
    }

    .search_result li.search_result_countdown_box[trash="true"] .search_result_countdown_title {
      text-decoration-line: line-through;
      text-decoration-color: var(--d-333333);
      font-style: italic;
      color: var(--d-e3e3e3)
    }

    canvas#countdown-photo {
      display: none;
    }

    input#importcountdowndatainput {
      opacity: 0;
      width: 0px;
      height: 0px;
      background: transparent;
      -webkit-appearance: none;
      appearance: none;
    }

    @media only screen and (max-width: 600px) {
      .count {
        width: 25px;
        height: 45px;
        border-radius: 5px;
      }

      .count_track {
        transform: translateY(calc(var(--count-number) * -45px));
      }

      .count_track span {
        font-size: 15px
      }
    }
  </style>
  <style id="options_css"></style>
</head>

<body>
  <canvas id="countdown-photo"></canvas>
  <input type="file" id="importcountdowndatainput" name="importcountdowndatainput" accept="application/json">
  <div class="title">
    <span id="content_box_title_text">Countdown</span>

    <div class="trash_back_btn" r-click="closetrashcan()">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--d-333333)"
          fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>

    <div class="options_btn" r-click="openoptions(0)" loading="1">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path
          d="M4.8 36.8C3.46667 36.8 2.33333 36.3333 1.4 35.4C0.466666 34.4667-6.35783e-07 33.3333 7.10543e-15 32C7.10543e-15 30.6667 0.466667 29.5333 1.4 28.6C2.33333 27.6667 3.46667 27.2 4.8 27.2C6.13333 27.2 7.26667 27.6667 8.2 28.6C9.13333 29.5333 9.6 30.6667 9.6 32C9.6 33.3333 9.13333 34.4667 8.2 35.4C7.26667 36.3333 6.13333 36.8 4.8 36.8ZM32 36.8C30.6667 36.8 29.5333 36.3333 28.6 35.4C27.6667 34.4667 27.2 33.3333 27.2 32C27.2 30.6667 27.6667 29.5333 28.6 28.6C29.5333 27.6667 30.6667 27.2 32 27.2C33.3333 27.2 34.4667 27.6667 35.4 28.6C36.3333 29.5333 36.8 30.6667 36.8 32C36.8 33.3333 36.3333 34.4667 35.4 35.4C34.4667 36.3333 33.3333 36.8 32 36.8ZM59.2 36.8C57.8667 36.8 56.7333 36.3333 55.8 35.4C54.8667 34.4667 54.4 33.3333 54.4 32C54.4 30.6667 54.8667 29.5333 55.8 28.6C56.7333 27.6667 57.8667 27.2 59.2 27.2C60.5333 27.2 61.6667 27.6667 62.6 28.6C63.5333 29.5333 64 30.6667 64 32C64 33.3333 63.5333 34.4667 62.6 35.4C61.6667 36.3333 60.5333 36.8 59.2 36.8Z"
          fill="var(--d-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>
    <div class="search_btn" r-click="opensearchpage()" u="0" loading="1">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink" id="svgsearchicon">
        <path
          d="M60.0889 64L36.7111 40.6222C34.9333 42.163 32.8593 43.363 30.4889 44.2222C28.1185 45.0815 25.6 45.5111 22.9333 45.5111C16.5333 45.5111 11.1111 43.2889 6.66667 38.8444C2.22222 34.4 1.41285e-06 29.037 8.4771e-07 22.7556C8.4771e-07 16.4741 2.22222 11.1111 6.66667 6.66667C11.1111 2.22222 16.5037 3.55271e-15 22.8444 3.55271e-15C29.1259 3.55271e-15 34.4741 2.22222 38.8889 6.66667C43.3037 11.1111 45.5111 16.4741 45.5111 22.7556C45.5111 25.3037 45.0963 27.763 44.2667 30.1333C43.437 32.5037 42.1926 34.7259 40.5333 36.8L64 60.0889L60.0889 64ZM22.8444 40.1778C27.6444 40.1778 31.7333 38.4741 35.1111 35.0667C38.4889 31.6593 40.1778 27.5556 40.1778 22.7556C40.1778 17.9556 38.4889 13.8519 35.1111 10.4444C31.7333 7.03704 27.6444 5.33333 22.8444 5.33333C17.9852 5.33333 13.8519 7.03704 10.4444 10.4444C7.03704 13.8519 5.33333 17.9556 5.33333 22.7556C5.33333 27.5556 7.03704 31.6593 10.4444 35.0667C13.8519 38.4741 17.9852 40.1778 22.8444 40.1778Z"
          fill="var(--d-333333)" fill-rule="nonzero" opacity="1" stroke="none" />
      </svg>

      <div class="back_btn" r-click="closesearchpage()">
        <svg stroke-miterlimit="10"
          style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
          viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
          xmlns:xlink="http://www.w3.org/1999/xlink">
          <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--d-333333)"
            fill-rule="evenodd" opacity="1" stroke="none" />
        </svg>
      </div>
      <input type="text" id="search_countdown" placeholder="search">

    </div>
    <div class="delete_btn" r-click="deleteselected()">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path
          d="M12.5333 64C11.1111 64 9.86667 63.4667 8.8 62.4C7.73333 61.3333 7.2 60.0889 7.2 58.6667L7.2 8L3.55556 8L3.55556 2.66667L20.2667 2.66667L20.2667 7.10543e-15L43.7333 7.10543e-15L43.7333 2.66667L60.4444 2.66667L60.4444 8L56.8 8L56.8 58.6667C56.8 60.0889 56.2667 61.3333 55.2 62.4C54.1333 63.4667 52.8889 64 51.4667 64L12.5333 64ZM51.4667 8L12.5333 8L12.5333 58.6667L51.4667 58.6667L51.4667 8ZM21.9556 51.0222L27.2889 51.0222L27.2889 15.5556L21.9556 15.5556L21.9556 51.0222ZM36.7111 51.0222L42.0444 51.0222L42.0444 15.5556L36.7111 15.5556L36.7111 51.0222ZM12.5333 8L12.5333 58.6667L12.5333 8Z"
          fill="var(--d-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>
    <div class="cancel_btn" r-click="cancelselect()">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path
          d="M4.92308 64L1.67679e-06 59.0769L27.0769 32L2.79465e-06 4.92308L4.92308 1.11786e-06L32 27.0769L59.0769 7.10543e-15L64 4.92308L36.9231 32L64 59.0769L59.0769 64L32 36.9231L4.92308 64Z"
          fill="var(--d-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>

  </div>
  <div class="content_box"></div>
  <div class="addcountdown" r-click="openaddcountdown()" loading="1">
    <svg stroke-miterlimit="10" style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;"
      version="1.1" viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
      xmlns:xlink="http://www.w3.org/1999/xlink">
      <path
        d="M28.5714 64L28.5714 35.4286L0 35.4286L0 28.5714L28.5714 28.5714L28.5714 0L35.4286 0L35.4286 28.5714L64 28.5714L64 35.4286L35.4286 35.4286L35.4286 64L28.5714 64Z"
        fill="var(--d-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
    </svg>
  </div>

  <div class="search_countdown_content_box">
    <div class="search_result"></div>
  </div>


  <div class="countdown_title">
    <div class="back_btn" r-click="closecountdown()">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--d-333333)"
          fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>
    <span id="countdown_title_text"></span>

    <div class="options_btn" r-click="openoptions(1)">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path
          d="M4.8 36.8C3.46667 36.8 2.33333 36.3333 1.4 35.4C0.466666 34.4667-6.35783e-07 33.3333 7.10543e-15 32C7.10543e-15 30.6667 0.466667 29.5333 1.4 28.6C2.33333 27.6667 3.46667 27.2 4.8 27.2C6.13333 27.2 7.26667 27.6667 8.2 28.6C9.13333 29.5333 9.6 30.6667 9.6 32C9.6 33.3333 9.13333 34.4667 8.2 35.4C7.26667 36.3333 6.13333 36.8 4.8 36.8ZM32 36.8C30.6667 36.8 29.5333 36.3333 28.6 35.4C27.6667 34.4667 27.2 33.3333 27.2 32C27.2 30.6667 27.6667 29.5333 28.6 28.6C29.5333 27.6667 30.6667 27.2 32 27.2C33.3333 27.2 34.4667 27.6667 35.4 28.6C36.3333 29.5333 36.8 30.6667 36.8 32C36.8 33.3333 36.3333 34.4667 35.4 35.4C34.4667 36.3333 33.3333 36.8 32 36.8ZM59.2 36.8C57.8667 36.8 56.7333 36.3333 55.8 35.4C54.8667 34.4667 54.4 33.3333 54.4 32C54.4 30.6667 54.8667 29.5333 55.8 28.6C56.7333 27.6667 57.8667 27.2 59.2 27.2C60.5333 27.2 61.6667 27.6667 62.6 28.6C63.5333 29.5333 64 30.6667 64 32C64 33.3333 63.5333 34.4667 62.6 35.4C61.6667 36.3333 60.5333 36.8 59.2 36.8Z"
          fill="var(--d-333333)" fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>

  </div>
  <div class="countdown_content_box">
    <div class="countdown_content_box_count"></div>
    <div class="countdown_content_box_line"></div>
    <div class="countdown_content_box_details">
      <div id="countdown_content_box_details_title" class="h3"></div>
      <div id="countdown_content_box_details_description" class="p"></div>
      <div id="countdown_content_box_details_date" class="p"></div>
    </div>

  </div>
  <div class="add_countdown_title">
    <div class="back_btn" r-click="closeaddcountdown()">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--d-333333)"
          fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>
    <span id="add_countdown_title_text">Add Countdown</span>
  </div>
  <div class="add_countdown_content_box">
    <input type="text" placeholder="Title" id="add_title" c="1">
    <textarea placeholder="Description" id="add_description"></textarea>
    <div class="date_input_group">
      <div class="date_input_group_date">
        <input type="text" id="add_date_year" placeholder="Year" inputmode="numeric">
        <input type="text" id="add_date_month" placeholder="Month" inputmode="numeric">
        <input type="text" id="add_date_date" placeholder="Date" inputmode="numeric">
      </div>
      <div class="date_input_group_time">
        <input type="text" id="add_date_hour" placeholder="Hour" inputmode="numeric">
        <input type="text" id="add_date_minute" placeholder="Minute" inputmode="numeric">
        <input type="text" id="add_date_second" placeholder="Second" inputmode="numeric">
      </div>
    </div>
    <div class="add_countdown_btn" r-click="addcountdown(0)">Add</div>
  </div>

  <div class="edit_countdown_title">
    <div class="back_btn" r-click="closeeditcountdown()" id="edit_back_btn">
      <svg stroke-miterlimit="10"
        style="fill-rule:nonzero;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;" version="1.1"
        viewBox="0 0 64 64" xml:space="preserve" xmlns="http://www.w3.org/2000/svg"
        xmlns:xlink="http://www.w3.org/1999/xlink">
        <path d="M32 64L0 32L32 0L36.2 4.2L11.4 29L64 29L64 35L11.4 35L36.2 59.8L32 64Z" fill="var(--d-333333)"
          fill-rule="evenodd" opacity="1" stroke="none" />
      </svg>
    </div>
    <span id="edit_countdown_title_text">Edit Countdown</span>
  </div>
  <div class="edit_countdown_content_box">
    <input type="text" placeholder="Title" id="edit_title" c="1">
    <textarea placeholder="Description" id="edit_description"></textarea>
    <div class="date_input_group">
      <div class="date_input_group_date">
        <input type="text" id="edit_date_year" placeholder="Year" inputmode="numeric">
        <input type="text" id="edit_date_month" placeholder="Month" inputmode="numeric">
        <input type="text" id="edit_date_date" placeholder="Date" inputmode="numeric">
      </div>
      <div class="date_input_group_time">
        <input type="text" id="edit_date_hour" placeholder="Hour" inputmode="numeric">
        <input type="text" id="edit_date_minute" placeholder="Minute" inputmode="numeric">
        <input type="text" id="edit_date_second" placeholder="Second" inputmode="numeric">
      </div>
    </div>
    <div class="edit_countdown_btn" r-click="savecountdown()">Save</div>
  </div>




  <div class="options_mask" r-click="closeoptions()"></div>
  <div class="options">
    <li r-click="editcountdown()" y="edit" group="0" b="0">Edit</li>
    <li r-click="refreshpage()" y="refresh" group="0">Refresh</li>
    <li r-click="downloadCountdownDataFile()" y="export" group="0">Export data</li>
    <li r-click="importCountdownData()" y="import" group="0">Import data</li>
    <li r-click="viewongithub()" y="github" group="0">Github</li>
    <li r-click="editcountdown_detail()" y="edit2" group="1" b="0">Edit</li>
    <li r-click="sharecountdown()" y="share" group="1">Share as link</li>
    <li r-click="shareCountdownPhoto()" y="shcountdownphoto" group="1">Share as photo</li>
    <li r-click="addToCalendar()" y="addtocalendar" group="1">Add to Calendar</li>
    <li r-click="deletecountdown()" y="delete" group="1">Delete</li>
  </div>
</body>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script>
  var getUrlString = location.href;
  var url = new URL(getUrlString);
  function urlparams(p) {
    return url.searchParams.get(p)
  }
  (function ($) {
    $.fn.prompt = function (options) {
      var settings = $.extend(
        {
          message: "undefined",
          time: 2000,
        },
        options
      );

      return this.each(function () {
        $('.prompt,style[promptanimation="promptanimation"]').remove();
        var promptchars = "0123456789abcdefghijklmnopqrstuvwxyz";
        var promptid = "";
        for (var i = 0; i < 10; i++) {
          var randomNumber = Math.floor(Math.random() * promptchars.length);
          promptid += promptchars.substring(randomNumber, randomNumber + 1);
        }
        var translateY = -1 * (20)
        $(this).append('<style qix="promptanimation' + promptid + '" promptanimation="promptanimation">.promptanimation' + promptid + '{animation-name:prompt' + promptid + ';animation-duration:' + (settings.time + 300 * 2) + 'ms;animation-fill-mode:forwards;animation-timing-function:ease-in-out}@keyframes prompt' + promptid + '{0%{opacity:0;transform:translateX(-50%) translateY(' + translateY + 'px) scale(0.75);}' + Math.floor((300) / (settings.time + 300 + 150) * 100) + '%{opacity:1;transform:translateX(-50%) translateY(' + translateY + 'px) scale(1);}' + Math.floor((300 + settings.time) / (settings.time + 300 + 150) * 100) + '%{opacity:1;transform:translateX(-50%) translateY(' + translateY + 'px) scale(1);}100%{opacity:0;transform:translateX(-50%) translateY(' + translateY + 'px) scale(1);}}</style><div class="prompt promptanimation' + promptid + '" id="' + promptid + '"><span class="promptcenter">' + settings.message + "</span></div>");

        setTimeout(function () {
          $("#" + promptid + ',style[qix="promptanimation' + promptid + '"]').remove();
        }, settings.time + 400 * 2 + 50);
      });
    };
  })(jQuery);
  function mes(mess) {
    $('body').prompt({ 'message': mess, 'time': 1200 });
  }
  function randid(n) {
    var genidchars = "0123456789abcdefghijklmnopqrstuvwxyz";
    var genid = "";
    for (var i = 0; i < 16; i++) {
      var genrandomNumber = Math.floor(Math.random() * genidchars.length);
      genid += genidchars.substring(genrandomNumber, genrandomNumber + 1);
    }
    if (!(n === undefined)) {
      n = n.replaceAll('_', '-')
      return n + '-' + (new Date().getTime()).toString(36) + '-' + genid;
    }
    return (new Date().getTime()).toString(36) + '-' + genid;
  }
  function rclick(select) {
    $(select).click(function (e) {
      e.stopPropagation()
      if ($(this).attr('r-click') != '') {
        eval('setTimeout(function() {' + $(this).attr('r-click') + '},' + 1 + ');');
      }
    });
  }
  function searchItemsbyname(name) {
    var gh = []
    for (var t in window.localStorage) {
      if (String(t).indexOf(name) > -1) {
        gh.push(t)
      }
    }
    return gh
  }
  function sort_arr(arr, sort_key) {
    arr.sort(function (a, b) {
      return a[sort_key] - b[sort_key]
    });
    return arr
  }
  function countdown_trash_check() {
    var list_all = searchItemsbyname('countdown_x_')
    var list_all_len = list_all.length
    var nowtime = new Date().getTime()
    for (var o = 0; o < list_all_len; o++) {
      if (!(localStorage.hasOwnProperty(String(list_all[o])))) {
        continue;
      }
      var this_json = JSON.parse(localStorage.getItem(String(list_all[o])))
      if (this_json.hasOwnProperty('trash')) {
        if (this_json['trash']) {
          if (!(this_json.hasOwnProperty('trash_date'))) {
            this_json['trash_date'] = nowtime
            localStorage.setItem(String(list_all[o]), JSON.stringify(this_json))
          }
          if ((nowtime - this_json['trash_date']) > 60 * 60 * 24 * 30 * 1000) {
            localStorage.removeItem(String(list_all[o]))
          }
        }
      }
      else {
        this_json['trash'] = false
        localStorage.setItem(String(list_all[o]), JSON.stringify(this_json))
      }
    }
  }
  function print_countdown(k) {
    var content_box = '.content_box'
    var now_time = new Date().getTime()
    var list_all = searchItemsbyname('countdown_x_')
    var list_unfinished = []
    var list_finished = []
    var list_trash = []
    var list_all_len = list_all.length
    var title_max_len = Math.floor((window.innerWidth - 20 - 110 - 6) / getTextAvgWidth())
    if (list_all_len < 1) {
      $(content_box + ' .loading').remove()
      return ''
    }

    for (var d = 0; d < list_all_len; d++) {
      var this_json = JSON.parse(localStorage.getItem(String(list_all[d])))
      list_all[d] = this_json
      if (this_json.hasOwnProperty('trash')) {
        if (this_json['trash'] && k === 0) {
          continue;
        }
        else {
          if (this_json['trash'] && k === 1) {
            list_trash.push(this_json)
          }
        }
      }
      if (this_json.date > now_time) {
        list_unfinished.push(this_json)
      }
      else {
        list_finished.push(this_json)
      }
    }

    list_unfinished = sort_arr(list_unfinished, 'date')
    list_finished = sort_arr(list_finished, 'date').reverse()
    if (k === 0) {
      list = list_unfinished.concat(list_finished)
    }
    if (k === 1) {
      list = sort_arr(list_trash, 'trash_date')
    }
    list_len = list.length

    for (var e = 0; e < list_len; e++) {
      var this_list = list[e]
      var this_title = this_list.title
      if (this_title.length > title_max_len) {
        this_title = String(this_title).substring(0, title_max_len - 3) + '...'
      }
      var this_description = this_list.description
      if (this_description.length > 45) {
        this_description = String(this_description).substring(0, 42) + '...'
      }

      var this_date = this_list.date
      if (k === 1) {
        this_date = this_list.trash_date + (60 * 60 * 24 * 30 * 1000)
      }
      var this_id = randid('countdown')
      var trash = false
      if (k === 1) {
        trash = true
      }
      $(content_box).append('<div class="countdown_box" id="' + this_id + '" r-click="opencountdown(' + "'" + this_list.id + "'" + ')" trash="' + trash + '"><div class="countdown_box_select"><label for="checkbox-' + this_list.id + '"><input type="checkbox" countdown-id="' + this_list.id + '" name="checkbox-' + this_list.id + '" id="checkbox-' + this_list.id + '"></label></div><div class="countdown_box_count" t="' + this_date + '"></div><div class="countdown_box_title">' + this_title + '</div><div class="countdown_box_description">' + this_description + '</div></div>')
      rclick('#' + this_id)
    }
    $(content_box + ' .loading').remove()
  }
  function refresh_countdown() {
    $('.content_box').html('')
    print_countdown(0)
  }
  function opentrashcan() {
    $('.content_box').html('')
    $('#content_box_title_text').text('Trash Can')
    $('.title .options_btn,.title .search_btn,.addcountdown').css({ 'display': 'none' })
    $('.trash_back_btn').css({ 'display': 'flex' })
    print_countdown(1)
  }
  function closetrashcan() {
    $('.content_box').html('')
    $('#content_box_title_text').text('Countdown')
    $('.title .options_btn,.title .search_btn,.addcountdown').css({ 'display': 'flex' })
    $('.trash_back_btn').css({ 'display': 'none' })
    print_countdown(0)
  }
  function check_i(i) {
    if (i < 10) {
      return '0' + i
    }
    else {
      return i
    }
  }
  function tday(start, end, mode) {
    var ms = end.getTime() - start.getTime()
    if (ms < 0) {
      ms = 0
    }
    var dt = function (st_t, end_t) {
      var st = new Date()
      st.setTime(st_t.getTime())
      var end = new Date()
      end.setTime(end_t.getTime())

      st.setDate(st.getDate() + 1)
      st.setHours(0)
      st.setMinutes(0)
      st.setSeconds(0)

      end.setDate(end.getDate() - 0)
      end.setHours(0)
      end.setMinutes(0)
      end.setSeconds(0)

      var st_hh = 23 - st_t.getHours()
      var st_mm = 59 - st_t.getMinutes()
      var st_ss = 60 - st_t.getSeconds()
      var st_y = st.getFullYear()
      var end_y = end.getFullYear()
      var full_y = end_y - st_y - 1
      var st_a_m = 12 - (st.getMonth() + 1)
      var st_d_m = new Date()
      st_d_m.setFullYear(st.getFullYear())
      st_d_m.setMonth(st.getMonth() + 1)
      st_d_m.setDate(0)
      var st_a_d = st_d_m.getDate() - st.getDate()
      var end_hh = end_t.getHours()
      var end_mm = end_t.getMinutes()
      var end_ss = end_t.getSeconds()
      var end_a_m = end.getMonth()
      var end_a_d = end.getDate() - 1
      var t_m = st_a_m + end_a_m
      var t_d = st_a_d + end_a_d
      var t_hh = st_hh + end_hh
      var t_mm = st_mm + end_mm
      var t_ss = st_ss + end_ss
      if (t_ss >= 60) {
        var ssu = (t_ss - (t_ss % 60)) / 60
        t_mm += ssu
        t_ss -= ssu * 60
      }
      if (t_mm >= 60) {
        var mmu = (t_mm - (t_mm % 60)) / 60
        t_hh += mmu
        t_mm -= mmu * 60
      }
      if (t_hh >= 24) {
        var hhu = (t_hh - (t_hh % 24)) / 24
        t_d += hhu
        t_hh -= hhu * 24
      }
      if (t_d >= 30) {
        var du = (t_d - (t_d % 30)) / 30
        t_m += du
        t_d -= du * 30
      }
      if (t_m >= 12) {
        var mu = (t_m - (t_m % 12)) / 12
        full_y += mu
        t_m -= mu * 12
      }
      return [full_y, t_m, t_d, t_hh, t_mm, t_ss]
    }

    var gy = dt(start, end)
    if (mode === 0) {
      if (gy[0] > 0) {
        return gy[0] + 'Y'
      }
      if (gy[1] > 0) {
        return gy[1] + 'M'
      }
      if (gy[2] > 0) {
        return gy[2] + 'D'
      }
      if (gy[3] > 0) {
        return gy[3] + 'h'
      }
      if (gy[4] > 0) {
        return gy[4] + 'm'
      }
      if (gy[5] > 0) {
        return gy[5] + 's'
      }
      return '--'
    }
    if (mode === 1) {
      var return_arr = []
      if (gy[0] > 0) {
        return_arr.push(gy[0] + 'year')
      }
      if (gy[1] > 0) {
        return_arr.push(gy[1] + 'month')
      }
      if (gy[2] > 0) {
        return_arr.push(gy[2] + 'day')
      }
      if (gy[3] > 0) {
        return_arr.push(gy[3] + 'hour')
      }
      if (gy[4] > 0) {
        return_arr.push(gy[4] + 'minute')
      }
      if (gy[5] > 0) {
        return_arr.push(gy[5] + 'sec')
      }
      return return_arr
    }
    if (mode === 2) {
      var padding = function (n) {
        if (n < 10) {
          return '0' + n
        }
        else {
          return n
        }
      }
      var string_arr = []
      var return_arr = []
      var p_ym_e, p_day_e, p_hour_e, p_minute_e
      if (gy[0] > 0) {
        string_arr.push(gy[0])
        string_arr.push('Y')
      }

      if (gy[1] > 0) {
        string_arr.push(gy[1])
        string_arr.push('M')
        p_ym_e = 1
      }

      if (gy[2] > 0) {
        string_arr.push(gy[2])
        string_arr.push('D')
        p_ym_e = 1
      }

      if (gy[3] > 0) {
        string_arr.push(padding(gy[3]))
        string_arr.push('h')
        p_ym_e = 1
      }
      else {
        if (p_ym_e === 1) {
          string_arr.push('00')
          string_arr.push('h')
          p_day_e = 1
        }
      }
      if (gy[4] > 0) {
        string_arr.push(padding(gy[4]))
        string_arr.push('m')
        p_hour_e = 1
      }
      else {
        if (p_day_e === 1) {
          string_arr.push('00')
          string_arr.push('m')
          p_hour_e = 1
        }
      }

      if (gy[5] > 0) {
        string_arr.push(padding(gy[5]))
        string_arr.push('s')
        p_minute_e = 1
      }
      else {
        if (p_hour_e === 1) {
          string_arr.push('00')
          string_arr.push('s')
          p_minute_e = 1
        }
      }

      var string_len = String(string_arr.join('')).length
      var count_len = $('.countdown_content_box_count .count').length
      if (count_len > string_len) {
        var delete_len = count_len - string_len
        var delete_offset = 0
        for (var r = 0; r < delete_len; r++) {
          $('.countdown_content_box_count .count').eq(r - delete_offset).remove()
          delete_offset += 1
        }
      }
      if (count_len < string_len) {
        var add_len = string_len - count_len
        for (var r = 0; r < add_len; r++) {
          $('.countdown_content_box_count').append('<div class="count" style="--count-number:0"><div class="count_track"><span>0</span><span>1</span><span>2</span><span>3</span><span>4</span><span>5</span><span>6</span><span>7</span><span>8</span><span>9</span><span>Y</span><span>M</span><span>D</span><span>h</span><span>m</span><span>s</span></div></div>')
        }
      }
      var string_arr_str = string_arr.join('')
      for (var r = 0; r < string_len; r++) {
        var this_str = string_arr_str.substring(r, r + 1)
        var num = 0
        if (this_str === 'Y' || this_str === 'M' || this_str === 'D' || this_str === 'h' || this_str === 'm' || this_str === 's') {
          if (this_str === 'Y') {
            num = 10
          }
          if (this_str === 'M') {
            num = 11
          }
          if (this_str === 'D') {
            num = 12
          }
          if (this_str === 'h') {
            num = 13
          }
          if (this_str === 'm') {
            num = 14
          }
          if (this_str === 's') {
            num = 15
          }
        }
        else {
          num = parseInt(this_str)
        }
        $('.countdown_content_box_count .count').eq(r).css({ '--count-number': num })
      }
    }
  }
  var countdown_pause = 0
  function countdown_update() {
    var countdown_len = $('.content_box .countdown_box').length
    for (var e = 0; e < countdown_len; e++) {
      var this_h = $('.content_box .countdown_box .countdown_box_count').eq(e)
      var thswww = this_h.offset().top - $(document).scrollTop()
      var thshh = this_h.height()
      if (thswww > (0 - thshh) && thswww < window.innerHeight && !(this_h.attr('f') === '1')) {

        var time = parseInt(this_h.attr('t'))
        var time_date = new Date()
        time_date.setTime(time)
        var nowtime = new Date()
        var f = (time - nowtime.getTime())
        if (f > 0) {
          this_h.text(tday(nowtime, time_date, 0))
        }
        else {
          this_h.text('Finish')
          this_h.attr('f', '1')
        }
      }
    }
    if (countdown_pause === 0) {
      window.requestAnimationFrame(countdown_update);
    }
    else {
      countdown_pause = 0
      return ''
    }
  }
  function openaddcountdown() {
    $('.add_countdown_title').css({ 'display': 'flex' })
    $('.add_countdown_content_box').css({ 'display': 'block' })
    $('#add_title').val('')
    $('#add_description').val('')
    $('#add_countdown_title_text').text('Add Countdown')
    $('#add_date_year').val('')
    $('#add_date_month').val('')
    $('#add_date_date').val('')
    $('#add_date_hour').val('')
    $('#add_date_minute').val('')
    $('#add_date_second').val('')
  }
  function closeaddcountdown() {
    $('.add_countdown_title,.add_countdown_content_box').css({ 'display': 'none' })

  }
  function check_int(str) {
    if (String(parseInt(String(str))) === 'NaN' || String(str) === '') {
      return undefined
    }
    else {
      return parseInt(String(str))
    }
  }
  function addcountdown(m) {
    if (m === 0) {
      var data_y = $('#add_date_year').val()
      var data_m = $('#add_date_month').val()
      var data_d = $('#add_date_date').val()
      var data_h = $('#add_date_hour').val()
      var data_min = $('#add_date_minute').val()
      var data_s = $('#add_date_second').val()
      var data_title = $('#add_title').val() || 'Untitled'
      var data_description = $('#add_description').val() || ''
    }
    if (m === 1) {
      if (urlparams('a') === '1') {
        var data_y = urlparams('add_y')
        var data_m = urlparams('add_m')
        var data_d = urlparams('add_d')
        var data_h = urlparams('add_h')
        var data_min = urlparams('add_min')
        var data_s = urlparams('add_s')
        var data_title = urlparams('add_title') || 'Untitled'
        var data_description = urlparams('add_desc') || ''
      }
    }
    var title = data_title
    var description = data_description
    var date = new Date()

    var year = check_int(data_y) || date.getFullYear()
    var month = check_int(data_m) || (date.getMonth() + 1)
    var date_d = check_int(data_d) || date.getDate()
    var hour = check_int(data_h) || 0
    var minute = check_int(data_min) || 0
    var second = check_int(data_s) || 0

    date.setFullYear(year)
    date.setMonth((month - 1))
    date.setDate(date_d)
    date.setHours(hour)
    date.setMinutes(minute)
    date.setSeconds(second)

    date = date.getTime()
    var id = ''
    var id_chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789'
    for (var i = 0; i < 32; i++) {
      var rdn = Math.floor(Math.random() * id_chars.length)
      var rdnstr = id_chars.substring(rdn, rdn + 1)
      id += rdnstr
    }
    var json = {
      'title': title,
      'description': description,
      'date': date,
      'trash': false,
      'id': id
    }
    localStorage.setItem('countdown_x_' + id, JSON.stringify(json))
    closeaddcountdown()
    $('#add_title').val('')
    $('#add_description').val('')
    $('#add_date_year').val('')
    $('#add_date_month').val('')
    $('#add_date_date').val('')
    $('#add_date_hour').val('')
    $('#add_date_minute').val('')
    $('#add_date_second').val('')
    mes('Countdown added')
    refresh_countdown()
    opencountdown(id)
  }
  function countdown_content_count_update() {
    if (!($('.countdown_content_box_count').attr('f') === '1')) {
      var time = parseInt($('.countdown_content_box_count').attr('t'))
      var time_date = new Date()
      time_date.setTime(time)
      var nowtime = new Date()
      var f = (time - nowtime.getTime())
      if (f > 0) {
        tday(nowtime, time_date, 2)
        if ($('.countdown_content_box_count .countdown_content_box_count_finish').length > 0) {
          $('.countdown_content_box_count .countdown_content_box_count_finish').remove()
        }
        window.requestAnimationFrame(countdown_content_count_update);
      }
      else {
        $('.countdown_content_box_count').html('<span class="countdown_content_box_count_finish">Finish</span>').attr('f', '1')
      }
    }
  }
  function opencountdown(countdown_id) {
    if ($('.content_box').attr('edit') === '1') {
      return ''
    }
    if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {

      history.pushState(null, null, 'https://erichsia7.github.io/countdown/?c=1&id=' + countdown_id);
      var countdown_json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
      var date_o = new Date()
      date_o.setTime(parseInt(countdown_json.date))
      var date_str = ([date_o.getFullYear(), check_i(date_o.getMonth() + 1), check_i(date_o.getDate())]).join('/') + ' ' + ([check_i(date_o.getHours()), check_i(date_o.getMinutes()), check_i(date_o.getSeconds())]).join(':')
      $('.countdown_title').css({ 'display': 'flex' })
      $('.countdown_content_box').css({ 'display': 'block' })
      var t_title = countdown_json.title
      if (t_title.length > 15) {
        t_title = String(t_title).substring(0, 12) + '...'
      }
      $('#countdown_title_text').text(t_title)
      $('.countdown_content_box_count').attr('t', countdown_json.date).attr('f', '0')
      $('.countdown_content_box_details #countdown_content_box_details_title').text(countdown_json.title)
      $('.countdown_content_box_details #countdown_content_box_details_description').text(countdown_json.description)
      $('.countdown_content_box_details #countdown_content_box_details_date').text(date_str)
      window.requestAnimationFrame(countdown_content_count_update);
      $('.options li[y="edit2"]').attr('r-click', "editcountdown_detail('" + countdown_id + "')")
      $('.options li[y="share"]').attr('r-click', "sharecountdown('" + countdown_id + "')")
      $('.options li[y="delete"]').attr('r-click', "deletecountdown('" + countdown_id + "')")
      $('.options li[y="shcountdownphoto"]').attr('r-click', "shareCountdownPhoto('" + countdown_id + "')")
      $('.options li[y="addtocalendar"]').attr('r-click', "addToCalendar('" + countdown_id + "')")
    }
  }
  function closecountdown() {
    $('.countdown_title,.countdown_content_box').css({ 'display': 'none' })
    $('.countdown_content_box_count').attr('f', '1')
    history.pushState(null, null, 'https://erichsia7.github.io/countdown/');
  }
  function openoptions(r) {
    $('.options_mask').css({ 'display': 'block' })
    $('.options').css({ 'display': 'inline-block' })
    $('#options_css').html('.options li{display:none;}.options li[group="' + r + '"] {display:flex;}')
  }
  function closeoptions() {
    $('.options_mask,.options').css({ 'display': 'none' })
  }
  function editcountdown() {
    $('.content_box').attr('edit', '1')
    $('.cancel_btn,.delete_btn').css({ 'display': 'flex' })
    $('.options_btn,.search_btn').css({ 'display': 'none' })
    closeoptions()
  }
  function cancelselect() {
    $('.content_box').attr('edit', '0')
    $('.cancel_btn,.delete_btn').css({ 'display': 'none' })
    $('.options_btn,.search_btn').css({ 'display': 'flex' })
    var checkbox_len = $('.content_box input[type="checkbox"]').length
    for (var g = 0; g < checkbox_len; g++) {
      $('.content_box input[type="checkbox"]').eq(g).prop('checked', false)
    }
  }
  function deleteselected() {
    var checkbox_len = $('.content_box input[type="checkbox"]').length
    var deleted_len = 0
    var nowtime = new Date().getTime()
    for (var g = 0; g < checkbox_len; g++) {
      var this_checkbox = $('.content_box input[type="checkbox"]').eq(g)
      if (this_checkbox.prop('checked')) {
        deleted_len += 1
        var this_countdown_id = this_checkbox.attr('countdown-id')
        if (localStorage.hasOwnProperty('countdown_x_' + this_countdown_id)) {
          var json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
          json['trash'] = true
          json['trash_date'] = nowtime
          localStorage.setItem('countdown_x_' + this_countdown_id, JSON.stringify(json))
        }
      }
    }
    refresh_countdown()
    $('.content_box').attr('edit', '0')
    $('.cancel_btn,.delete_btn').css({ 'display': 'none' })
    $('.options_btn,.search_btn').css({ 'display': 'flex' })
    if (deleted_len > 0) {
      mes(deleted_len + ' countdown deleted.')
    }
  }

  function closeeditcountdown(countdown_id) {
    $('.edit_countdown_title,.edit_countdown_content_box').css({ 'display': 'none' })
    opencountdown(countdown_id)
  }

  function datestr(date) {
    var pad = function (num) {
      return (num < 10 ? '0' : '') + num;
    };
    return date.getFullYear() +
      '-' + pad(date.getMonth() + 1) +
      '-' + pad(date.getDate()) +
      'T' + pad(date.getHours()) +
      ':' + pad(date.getMinutes())
  }

  function editcountdown_detail(countdown_id) {
    if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {
      closeoptions()
      $('#edit_back_btn').attr('r-click', "closeeditcountdown('" + countdown_id + "')")
      $('.edit_countdown_title').css({ 'display': 'flex' })
      $('.edit_countdown_content_box').css({ 'display': 'block' })
      $('.countdown_content_box_count').attr('f', '1')
      var countdown_json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
      var date_o = new Date()
      date_o.setTime(parseInt(countdown_json.date))

      var year = date_o.getFullYear()
      var month = (date_o.getMonth() + 1)
      var date_d = date_o.getDate()
      var hour = date_o.getHours()
      var minute = date_o.getMinutes()
      var second = date_o.getSeconds()

      $('#edit_date_year').val(year)
      $('#edit_date_month').val(month)
      $('#edit_date_date').val(date_d)
      $('#edit_date_hour').val(hour)
      $('#edit_date_minute').val(minute)
      $('#edit_date_second').val(second)

      $('#edit_title').val(countdown_json.title)
      $('#edit_description').val(countdown_json.description)
      $('.edit_countdown_btn').attr('countdown-id', countdown_json.id)
    }
  }
  function sharecountdown(countdown_id) {
    if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {
      closeoptions()
      var countdown_json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
      var link = 'https://erichsia7.github.io/countdown/?s=1&j=' + btoa(encodeURIComponent(JSON.stringify(countdown_json)))
      if (navigator.share) {
        navigator.share({
          title: 'Countdown',
          url: link
        }).then(() => {
        })
          .catch(console.error);
      }
      else {
        //e
      }
    }
  }
  function deletecountdown(countdown_id) {
    if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {
      var nowtime = new Date().getTime()
      var json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
      json['trash'] = true
      json['trash_date'] = nowtime
      localStorage.setItem('countdown_x_' + countdown_id, JSON.stringify(json))
    }
    refresh_countdown()
    closecountdown()
    closeoptions()
    mes('Countdown deleted.')
  }
  function savecountdown() {
    var countdown_id = $('.edit_countdown_btn').attr('countdown-id')
    if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {
      var countdown_json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))

      var date_o = new Date()

      var year = check_int($('#edit_date_year').val()) || date_o.getFullYear()
      var month = check_int($('#edit_date_month').val()) || (date_o.getMonth() + 1)
      var date_d = check_int($('#edit_date_date').val()) || date_o.getDate()
      var hour = check_int($('#edit_date_hour').val()) || 0
      var minute = check_int($('#edit_date_minute').val()) || 0
      var second = check_int($('#edit_date_second').val()) || 0

      date_o.setFullYear(year)
      date_o.setMonth((month - 1))
      date_o.setDate(date_d)
      date_o.setHours(hour)
      date_o.setMinutes(minute)
      date_o.setSeconds(second)

      countdown_json.date = date_o.getTime()
      countdown_json.title = $('#edit_title').val()
      countdown_json.description = $('#edit_description').val()
      localStorage.setItem('countdown_x_' + countdown_id, JSON.stringify(countdown_json))
      closeeditcountdown(countdown_id)
      mes('Countdown edited')
      refresh_countdown()
    }
  }
  function unicode_arr(str) {
    var str_len = str.length
    var unicode_arr = []
    for (var t = 0; t < str_len; t++) {
      var unicode = str.charCodeAt(t)
      if (!(unicode_arr.indexOf(unicode) > -1)) {
        unicode_arr.push(unicode)
      }
    }
    return unicode_arr
  }
  function create_search_index() {
    var search_index = []
    var list = searchItemsbyname('countdown_x_')
    if (list.length < 1) {
      return []
    }
    var list_len = list.length
    for (var d = 0; d < list_len; d++) {
      list[d] = JSON.parse(localStorage.getItem(String(list[d])))
    }
    list_len = list.length
    for (var e = 0; e < list_len; e++) {
      var this_list = list[e]
      var this_id = this_list.id
      var this_title = this_list.title
      var this_description = this_list.description
      var this_trash = this_list.trash
      var this_trash_date = false
      if (this_trash) {
        this_trash_date = this_list.trash_date
      }
      var this_date = new Date()
      this_date.setTime(this_list.date)
      this_date = ([this_date.getFullYear(), check_i(this_date.getMonth() + 1), check_i(this_date.getDate())]).join('/') + ' ' + ([check_i(this_date.getHours()), check_i(this_date.getMinutes()), check_i(this_date.getSeconds())]).join(':')
      var str = [this_title, this_description, this_date, String(this_title).toLowerCase(), String(this_description).toLowerCase(), String(this_title).toUpperCase(), String(this_description).toUpperCase()].join('')
      var str_unicode = unicode_arr(str)
      search_index.push({ 'id': this_id, 'title': this_title, 'description': this_description, 'date': this_date, 'unicode': str_unicode, 'date_time': this_list.date, 'trash': this_trash, 'trash_date': this_trash_date })
    }
    return search_index
  }
  function search_result(q, search_index) {
    if (!(String(q).length > 0)) {
      return []
    }
    var now_time = new Date().getTime()
    var res_1 = []
    var res_2 = []
    var q_u = unicode_arr(q)
    var q_u_len = q_u.length
    var search_index_len = search_index.length
    for (var s = 0; s < search_index_len; s++) {
      var this_s = search_index[s]
      var this_s_u = this_s.unicode
      var res_t = false
      for (var f = 0; f < q_u_len; f++) {
        if (this_s_u.indexOf(q_u[f]) > -1) {
          res_t = true
          break;
        }
      }
      if (!(res_t)) {
        continue;
      }
      var res_t2 = false
      if (res_t)
        if (String(this_s.title).toLowerCase().indexOf(q.toLowerCase()) > -1) {
          res_t2 = true
        }
        else {
          if (String(this_s.description).toLowerCase().indexOf(q.toLowerCase()) > -1) {
            res_t2 = true
          }
          else {
            if (String(this_s.date).indexOf(q.toLowerCase()) > -1) {
              res_t2 = true
            }
          }
        }
      if (res_t2) {
        if (this_s.date_time > now_time) {
          res_2.push(this_s)
        }
        else {
          res_1.push(this_s)
        }
      }
    }
    res_1 = sort_arr(res_1, 'date_time').reverse()
    res_2 = sort_arr(res_2, 'date_time')
    var res_3 = res_2.concat(res_1)
    return res_3
  }
  function print_searchresult(res) {
    var res_htm = []
    var res_len = res.length
    var res_id = randid('searchres')
    var nowtime = new Date()
    for (var e = 0; e < res_len; e++) {
      var this_res = res[e]
      var this_res_date_time = this_res.date_time
      var this_res_title = this_res.title
      var this_res_id = this_res.id
      var this_res_trash = this_res.trash
      var this_res_trash_date = this_res.trash_date
      var this_res_trash_text = ''
      if (String(this_res_title).length > 15) {
        this_res_title = String(this_res_title).substring(0, 12) + '...'
      }
      if (this_res_trash) {
        var trash_day_date = (60 * 60 * 24 * 30 * 1000) + this_res_trash_date
        this_res_date_time = trash_day_date;
      }

      res_htm.push('<li class="search_result_countdown_box" r-click="opencountdown(' + "'" + this_res_id + "'" + ')" re="' + res_id + '" trash="' + this_res_trash + '"><div class="search_result_countdown_count" t="' + this_res_date_time + '" f="0"></div><div class="search_result_countdown_title">' + this_res_title + '</div></li>')
    }
    $('.search_result').html(res_htm.join(''))
    rclick('.search_result_countdown_box[re="' + res_id + '"]')
  }
  var search_result_countdown_count_pause = 0
  function search_result_countdown_count_update() {
    var now_time = new Date()
    var len = $('.search_result .search_result_countdown_box').length
    for (var w = 0; w < len; w++) {
      var this_w = $('.search_result .search_result_countdown_box .search_result_countdown_count').eq(w)
      if (!(this_w.attr('f') === '1')) {
        var this_w_date_time = parseInt(this_w.attr('t'))
        var this_w_date_time_date = new Date()
        this_w_date_time_date.setTime(this_w_date_time)
        var f = (this_w_date_time - now_time.getTime())
        if (f > 0) {
          this_w.text(tday(now_time, this_w_date_time_date, 0))
        }
        else {
          this_w.text('F')
          this_w.attr('f', '1')
        }
      }
      else {
        continue;
      }
    }
    if (search_result_countdown_count_pause === 0) {
      window.requestAnimationFrame(search_result_countdown_count_update)
    }
  }
  var search_input_evt = 0
  var serach_page = 0
  var search_index_cache = []
  function opensearchpage() {
    if ($('.search_btn').attr('u') === '1') {
      return ''
    }
    serach_page = 1
    $('.search_btn').attr('u', '1')
    $('.search_countdown_content_box').css({ 'display': 'block' })
    var qu = $('#search_countdown').val()
    search_index_cache = create_search_index()
    var result = search_result(qu, search_index_cache)
    print_searchresult(result)
    search_result_countdown_count_pause = 0
    search_result_countdown_count_update()
    if (search_input_evt === 0) {
      document.querySelector('#search_countdown').addEventListener("paste", function (e) {
        update_search_result()
      });
      document.querySelector('#search_countdown').addEventListener("cut", function (e) {
        update_search_result()
      });
      document.querySelector('#search_countdown').addEventListener("selectionchange", function (e) {
        update_search_result()
      });
      document.addEventListener("selectionchange", function (e) {
        if (serach_page === 1) {
          update_search_result()
        }
      });
      document.querySelector('#search_countdown').addEventListener("keyup", function (e) {
        update_search_result()
      });
      search_input_evt = 1
    }
  }
  function update_search_result() {
    var qu = $('#search_countdown').val()
    var result = search_result(qu, search_index_cache)
    print_searchresult(result)
  }
  function closesearchpage() {
    $('.search_countdown_content_box').css({ 'display': 'none' })
    $('.search_btn').attr('u', '0')
    search_result_countdown_count_pause = 1
    serach_page = 0
  }

  function getTextWidth(text, font) {
    const canvas = getTextWidth.canvas || (getTextWidth.canvas = document.createElement("canvas"));
    const context = canvas.getContext("2d");
    context.font = font;
    const metrics = context.measureText(text);
    return metrics.width;
  }

  function getTextAvgWidth() {
    var list = searchItemsbyname('countdown_x_')
    var list_len = list.length
    var list_str = []
    var unicode_arr = []
    for (var t = 0; t < list_len; t++) {
      if (localStorage.hasOwnProperty(list[t])) {
        var this_json = JSON.parse(String(localStorage.getItem(list[t])))
        var description = this_json.description
        var title = this_json.title
        var str = [description, title].join('')
        var str_arr = str.split('')
        var str_arr_len = str_arr.length
        for (var p = 0; p < str_arr_len; p++) {
          var this_str = str_arr[p]
          var this_u = this_str.charCodeAt(0)
          if (!(unicode_arr.indexOf(this_u) > -1)) {
            list_str.push(this_str)
            unicode_arr.push(this_u)
          }
        }
      }
    }
    var w = 500
    var s = 16
    return getTextWidth(list_str.join(''), w + " " + s + "px 'Noto Sans', sans-serif") / list_str.length
  }
  function drawCountdownPhoto(bg, txt, w, h, title, date, canvas) {
    var ctx = canvas.getContext('2d')
    var font = function (w, s) {
      return w + " " + s + "px 'Noto Sans', sans-serif"
    }
    var count_font_size = 128
    var title_font_size = 75
    var date_font_size = 38
    var link_font_size = 30
    var count_font_weight = 700
    var title_font_weight = 500
    var date_font_weight = 400
    var link_font_weight = 300
    var link = 'erichsia7.github.io/countdown'
    var count = '--'
    var padding = function (i) {
      if (i < 10) {
        return '0' + i
      }
      else {
        return i
      }
    }
    var t_check = function (t) {
      if (t < 1) {
        return true
      }
      if (t < 10) {
        return '0' + t
      }
      else {
        return t
      }
    }
    var tt_check = function (h, m) {
      if (h === true && m === true) {
        return ''
      }
      else {
        if (h === true) {
          h = '00'
        }
        if (m === true) {
          m = '00'
        }
        return ' ' + [h, m].join(':')
      }
    }
    var date_o = new Date()
    date_o.setTime(date)
    var date_str = [padding(date_o.getFullYear()), padding(date_o.getMonth() + 1), padding(date_o.getDate())].join('/') + tt_check(t_check(date_o.getHours()), t_check(date_o.getMinutes()))
    var now_time = new Date()
    var f_time = (date - now_time.getTime())
    if (f_time > 0) {
      count = tday(now_time, date_o, 0)
    }
    else {
      count = 'Finish'
    }

    var count_area_x = 0;
    var count_area_y = 0;
    var count_area_w = w;
    var count_area_h = h * 0.82;
    var count_w = getTextWidth(count, font(count_font_weight, count_font_size))
    var count_h = count_font_size
    var count_x = count_area_x + (count_area_w - count_w) / 2
    var count_y = count_area_y + (count_area_h - count_h) / 2

    var title_area_x = 0;
    var title_area_y = h * 0.42;
    var title_area_w = w;
    var title_area_h = h * 0.58;
    var title_w = getTextWidth(title, font(title_font_weight, title_font_size))
    var title_h = title_font_size
    var title_x = title_area_x + (title_area_w - title_w) / 2
    var title_y = title_area_y + (title_area_h - title_h) / 2

    var date_area_x = 0;
    var date_area_y = h * 0.58;
    var date_area_w = w;
    var date_area_h = h * 0.42;
    var date_w = getTextWidth(date_str, font(date_font_weight, date_font_size))
    var date_h = date_font_size
    var date_x = date_area_x + (date_area_w - date_w) / 2
    var date_y = date_area_y + (date_area_h - date_h) / 2

    var link_area_x = 0;
    var link_area_y = h * 0.85;
    var link_area_w = w;
    var link_area_h = h * 0.15;
    var link_w = getTextWidth(link, font(link_font_weight, link_font_size))
    var link_h = link_font_size
    var link_x = link_area_x + (link_area_w - link_w) / 2
    var link_y = link_area_y + (link_area_h - link_h) / 2

    canvas.width = w
    canvas.height = h
    ctx.fillStyle = bg
    ctx.fillRect(0, 0, w, h);
    ctx.textBaseline = 'top'
    ctx.fillStyle = txt;
    ctx.font = font(count_font_weight, count_font_size);
    ctx.fillText(count, count_x, count_y);
    ctx.font = font(title_font_weight, title_font_size);
    ctx.fillText(title, title_x, title_y);
    ctx.font = font(date_font_weight, date_font_size);
    ctx.fillText(date_str, date_x, date_y);
    ctx.font = font(link_font_weight, link_font_size);
    ctx.fillText(link, link_x, link_y);
  }
  function blobCallback(name) {
    return (b) => {
      const image = new File([b], name + '.png', { type: b.type })
      if (navigator.canShare && navigator.canShare({ files: [image] })) {
        navigator.share({
          files: [image]
        })
      }
      else {
        const a = document.createElement('a');
        document.body.appendChild(a);
        a.download = `${name}.png`;
        a.href = window.URL.createObjectURL(b);
        a.click()
        a.remove()
      }
    }
  }

  function getCountdownPhoto(countdown_id) {
    if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {
      var countdown_json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
      var title = countdown_json.title
      if (title.length > 15) {
        title = String(title).substring(0, 12) + '...'
      }
      var date = parseInt(countdown_json.date)
      var canvas = document.getElementById('countdown-photo')
      drawCountdownPhoto('#fafafa', '#333', 1024, 1024, title, date, canvas)
      canvas.toBlob(blobCallback(randid('countdown')), 'image/png')
    }
  }

  function shareCountdownPhoto(countdown_id) {
    getCountdownPhoto(countdown_id)
    closeoptions()
  }

  function getiCalendar(countdown_json) {
    var padding = function (b) {
      if (b < 10) {
        return '0' + b
      }
      else {
        return b
      }
    }
    var Date2Timestamp = function (date) {
      var timezoneoffset = new Date().getTimezoneOffset()
      date.setMinutes(date.getMinutes() + (timezoneoffset))
      var year = date.getFullYear()
      var month = padding(date.getMonth() + 1)
      var date2 = padding(date.getDate())
      var hour = padding(date.getHours())
      var minute = padding(date.getMinutes())
      var sec = padding(date.getSeconds())
      var str = [year, month, date2, 'T', hour, minute, sec, 'Z'].join('')
      return str
    }
    var now_time = Date2Timestamp(new Date())
    var start_time = new Date()
    start_time.setTime(countdown_json.date)
    start_time = Date2Timestamp(start_time)
    var end_time = new Date()
    end_time.setTime(parseInt(countdown_json.date) + 60 * 60 * 1000)
    end_time = Date2Timestamp(end_time)
    var tit = countdown_json.title
    var desc = String(countdown_json.description).replaceAll(/(?:\r\n|\r|\n)/g, '\u005C\u006E')
    var UID = countdown_json.id + '_' + randid()
    var ical_json = {
      'SUMMARY': tit,
      'DESCRIPTION': desc,
      'UID': UID,
      'CREATED': now_time,
      'LAST_MODIFIED': now_time,
      'DTSTAMP': start_time,
      'DTSTART': start_time,
      'DTEND': end_time,
      'SEQUENCE_s': 0
    }

    var ical_text = 'BEGIN:VCALENDAR\nVERSION:2.0\nBEGIN:VEVENT\nSUMMARY:' + ical_json.SUMMARY + '\nDESCRIPTION:' + ical_json.DESCRIPTION + '\nUID:' + ical_json.UID + '\nCREATED:' + ical_json.CREATED + '\nLAST-MODIFIED:' + ical_json.LAST_MODIFIED + '\nDTSTAMP:' + ical_json.DTSTAMP + '\nBEGIN:VALARM\nACTION:DISPLAY\nDESCRIPTION:Reminder\nTRIGGER:-PT60M\nEND:VALARM\nDTSTART:' + ical_json.DTSTART + '\nDTEND:' + ical_json.DTEND + '\nTRANSP:OPAQUE\nSEQUENCE:' + ical_json.SEQUENCE_s + '\nEND:VEVENT\nEND:VCALENDAR'
    return ical_text
  }
  function getiCalendarFile(countdown_id) {
    var json = JSON.parse(String(localStorage.getItem('countdown_x_' + countdown_id)))
    var txt = getiCalendar(json)
    var data = new Blob([txt], { type: 'text/calendar' });
    var uu = window.URL || window.webkitURL;
    var a = document.createElement('a');
    a.download = 'countdown' + '.ical';
    a.href = uu.createObjectURL(data);
    document.body.appendChild(a);
    a.click()
    a.remove()
  }
  function addToCalendar(countdown_id) {
    getiCalendarFile(countdown_id)
    closeoptions()
  }
  function exportCountdownData() {
    var list = searchItemsbyname('countdown_x_')
    var list_len = list.length
    var json_list = []
    for (var e = 0; e < list_len; e++) {
      if (localStorage.hasOwnProperty(list[e])) {
        var json = JSON.parse(String(localStorage.getItem(list[e])))
        json_list.push(json)
      }
    }
    return JSON.stringify(json_list)
  }
  function downloadCountdownDataFile() {
    var txt = exportCountdownData()
    var data = new Blob([txt], { type: 'application/json' })
    var name = randid('countdown_data_export')
    const filex = new File([data], name + '.json', { type: data.type })
    if (navigator.canShare && navigator.canShare({ files: [filex] })) {
      navigator.share({
        files: [filex]
      })
    }
    else {
      const a = document.createElement('a');
      document.body.appendChild(a);
      a.download = `${name}.json`;
      a.href = window.URL.createObjectURL(data);
      a.click()
      a.remove()
    }
  }

  function handleFileSelect(evt) {
    var f = evt.target.files[0];
    var reader = new FileReader();
    reader.onload = (function (theFile) {
      return function (e) {
        var tx = e.target.result;
        var json = JSON.parse(tx)
        var json_len = json.length
        for (var j = 0; j < json_len; j++) {
          var this_j = json[j]
          var this_j_str = JSON.stringify(this_j)
          var this_j_id = this_j.id
          localStorage.setItem('countdown_x_' + this_j_id, this_j_str)
        }
        mes('Data imported.')
        refresh_countdown()
        closeoptions()
      };
    })(f);
    reader.readAsText(f);
  }

  function importCountdownData() {
    $('#importcountdowndatainput').click()
  }
  function refreshpage() {
    location.replace('https://erichsia7.github.io/countdown/?' + randid())
    closeoptions()
  }
  function viewongithub() {
    closeoptions()
    window.open('https://github.com/EricHsia7/countdown/')
  }
  function initialize() {
    var load_len = Math.floor(window.innerHeight / 120) + 1
    var yy = []
    for (var y = 0; y < load_len; y++) {
      yy.push('<div class="countdown_box loading"><div class="countdown_box_count"></div><div class="countdown_box_title"></div><div class="countdown_box_description"></div></div>')
    }
    $('.content_box').html(yy.join(''))
    $(document).ready(function () {
      setTimeout(function () {
        countdown_trash_check()
        print_countdown(0)
        rclick('.addcountdown,.add_countdown_btn,.edit_countdown_btn,.back_btn,.options_btn,.options_mask,.options li,.cancel_btn,.delete_btn,.search_btn,.trash_back_btn')
        $('.search_btn,.options_btn,.addcountdown').attr('loading', '0')
        window.requestAnimationFrame(countdown_update);
      }, 1500)
      if (urlparams('c') === '1') {
        var countdown_id = urlparams('id')
        if (localStorage.hasOwnProperty('countdown_x_' + countdown_id)) {
          opencountdown(countdown_id)
        }
      }
      if (urlparams('s') === '1') {
        var json = JSON.parse(decodeURIComponent(atob(urlparams('j'))))
        var share_added = false
        if (!(localStorage.hasOwnProperty('countdown_x_' + json.id))) {
          localStorage.setItem('countdown_x_' + json.id, JSON.stringify(json))
          if (localStorage.hasOwnProperty('countdown_x_' + json.id)) {
            share_added = true
          }
        }
        if (localStorage.hasOwnProperty('countdown_x_' + json.id)) {
          opencountdown(json.id)
          if (share_added) {
            mes('Added 1 shared countdown.')
          }
        }
      }
      if (urlparams('a') === '1') {
        addcountdown(1)
      }
    })

    document.getElementById("importcountdowndatainput").addEventListener("change", handleFileSelect, false);

  }
  initialize()
</script>

</html>